<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PO Acknowledgment and Rejection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white shadow p-4 flex items-center justify-between">
    <h1 class="text-2xl font-semibold text-gray-800">Purchase Order Management</h1>
    <nav class="space-x-4 text-gray-600">
      <button id="tab-open" class="tab-btn px-3 py-1 rounded-md font-medium text-blue-600 border-b-2 border-blue-600">
        Open
      </button>
      <button id="tab-pending" class="tab-btn px-3 py-1 rounded-md font-medium text-gray-600 hover:text-blue-600 hover:border-blue-600 border-b-2 border-transparent">
        Pending
      </button>
      <button id="tab-closed" class="tab-btn px-3 py-1 rounded-md font-medium text-gray-600 hover:text-blue-600 hover:border-blue-600 border-b-2 border-transparent">
        Closed
      </button>
      <button id="tab-total" class="tab-btn px-3 py-1 rounded-md font-medium text-gray-600 hover:text-blue-600 hover:border-blue-600 border-b-2 border-transparent">
        Total
      </button>
    </nav>
  </header>

  <main class="flex-grow p-4 max-w-7xl mx-auto w-full">
    <section id="po-list" class="overflow-x-auto">
      <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th class="text-left px-4 py-3 font-semibold text-sm">PO Number</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Material</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Quantity</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Unit</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Delivery Date</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Net Price</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Total Amount</th>
            <th class="text-left px-4 py-3 font-semibold text-sm">Delivery Address</th>
            <th class="text-center px-4 py-3 font-semibold text-sm">Status</th>
            <th class="text-center px-4 py-3 font-semibold text-sm">Actions</th>
          </tr>
        </thead>
        <tbody id="po-table-body" class="divide-y divide-gray-200">
          <!-- PO rows will be inserted here -->
        </tbody>
      </table>
    </section>
  </main>

  <div class="flex justify-center mb-8">
    <button
      onclick="window.location.href='Vendor_Hompage_Screen_1.html'"
      class="px-6 py-2 bg-gray-200 text-[#355571] rounded hover:bg-gray-300 font-semibold transition"
      type="button"
    >
      &larr; Back
    </button>
  </div>

  <!-- Modal for Acknowledge / Reject -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg max-w-lg w-full mx-4">
      <div class="flex justify-between items-center border-b px-6 py-4">
        <h2 id="modal-title" class="text-xl font-semibold text-gray-800">PO Acknowledgment / Rejection</h2>
        <button id="modal-close" class="text-gray-600 hover:text-gray-900 focus:outline-none">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <form id="modal-form" class="px-6 py-4 space-y-4">
        <div>
          <label for="modal-po-number" class="block text-gray-700 font-medium mb-1">PO Number</label>
          <input type="text" id="modal-po-number" name="poNumber" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
        </div>
        <div>
          <label for="modal-material" class="block text-gray-700 font-medium mb-1">Material</label>
          <input type="text" id="modal-material" name="material" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
        </div>
        <div class="grid grid-cols-3 gap-4">
          <div>
            <label for="modal-quantity" class="block text-gray-700 font-medium mb-1">Quantity</label>
            <input type="number" id="modal-quantity" name="quantity" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
          </div>
          <div>
            <label for="modal-unit" class="block text-gray-700 font-medium mb-1">Unit</label>
            <input type="text" id="modal-unit" name="unit" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
          </div>
          <div>
            <label for="modal-delivery-date" class="block text-gray-700 font-medium mb-1">Delivery Date</label>
            <input type="date" id="modal-delivery-date" name="deliveryDate" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="modal-net-price" class="block text-gray-700 font-medium mb-1">Net Price</label>
            <input type="text" id="modal-net-price" name="netPrice" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
          </div>
          <div>
            <label for="modal-total-amount" class="block text-gray-700 font-medium mb-1">Total Amount</label>
            <input type="text" id="modal-total-amount" name="totalAmount" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" />
          </div>
        </div>
        <div>
          <label for="modal-delivery-address" class="block text-gray-700 font-medium mb-1">Delivery Address</label>
          <textarea id="modal-delivery-address" name="deliveryAddress" rows="2" readonly class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed resize-none"></textarea>
        </div>
        <div>
          <label for="modal-comments" class="block text-gray-700 font-medium mb-1">Comments (optional)</label>
          <textarea id="modal-comments" name="comments" rows="3" placeholder="Add comments here..." class="w-full border border-gray-300 rounded-md px-3 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
        <div class="flex justify-end space-x-3 pt-2 border-t">
          <button type="button" id="modal-acknowledge" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-5 py-2 rounded-md flex items-center space-x-2">
            <i class="fas fa-check-circle"></i><span>Acknowledge</span>
          </button>
          <button type="button" id="modal-reject" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-2 rounded-md flex items-center space-x-2">
            <i class="fas fa-times-circle"></i><span>Reject</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Sample PO data
    const poData = [
      {
        poNumber: 'PO10001',
        material: 'Steel Rods',
        quantity: 100,
        unit: 'Kg',
        deliveryDate: '2024-07-15',
        netPrice: 50.0,
        totalAmount: 5000.0,
        deliveryAddress: '123 Industrial Area, Peenya, Bangalore, Karnataka, India',
        status: 'Open',
      },
      {
        poNumber: 'PO10002',
        material: 'Copper Wire',
        quantity: 200,
        unit: 'Meters',
        deliveryDate: '2024-07-20',
        netPrice: 30.5,
        totalAmount: 6100.0,
        deliveryAddress: '456 Sector 18, Noida, Uttar Pradesh, India',
        status: 'Pending',
      },
      {
        poNumber: 'PO10003',
        material: 'Aluminum Sheets',
        quantity: 50,
        unit: 'Sheets',
        deliveryDate: '2024-07-10',
        netPrice: 120.0,
        totalAmount: 6000.0,
        deliveryAddress: '789 MIDC, Andheri East, Mumbai, Maharashtra, India',
        status: 'Closed',
      },
      {
        poNumber: 'PO10004',
        material: 'Plastic Granules',
        quantity: 500,
        unit: 'Kg',
        deliveryDate: '2024-07-25',
        netPrice: 10.0,
        totalAmount: 5000.0,
        deliveryAddress: '321 Industrial Estate, Guindy, Chennai, Tamil Nadu, India',
        status: 'Open',
      },
      {
        poNumber: 'PO10005',
        material: 'Rubber Seals',
        quantity: 1000,
        unit: 'Pieces',
        deliveryDate: '2024-07-18',
        netPrice: 2.5,
        totalAmount: 2500.0,
        deliveryAddress: '654 GIDC, Vatva, Ahmedabad, Gujarat, India',
        status: 'Pending',
      },
      {
        poNumber: 'PO10006',
        material: 'Glass Panels',
        quantity: 75,
        unit: 'Panels',
        deliveryDate: '2024-07-22',
        netPrice: 80.0,
        totalAmount: 6000.0,
        deliveryAddress: '987 Electronic City, Phase 1, Bangalore, Karnataka, India',
        status: 'Closed',
      },
      {
        poNumber: 'PO10007',
        material: 'Copper Pipes',
        quantity: 150,
        unit: 'Meters',
        deliveryDate: '2024-07-30',
        netPrice: 40.0,
        totalAmount: 6000.0,
        deliveryAddress: '159 Bhosari MIDC, Pune, Maharashtra, India',
        status: 'Open',
      },
      {
        poNumber: 'PO10008',
        material: 'Steel Bolts',
        quantity: 3000,
        unit: 'Pieces',
        deliveryDate: '2024-07-28',
        netPrice: 0.5,
        totalAmount: 1500.0,
        deliveryAddress: '753 Industrial Area, Sahibabad, Ghaziabad, Uttar Pradesh, India',
        status: 'Pending',
      },
      {
        poNumber: 'PO10009',
        material: 'Paint Cans',
        quantity: 250,
        unit: 'Cans',
        deliveryDate: '2024-07-12',
        netPrice: 15.0,
        totalAmount: 3750.0,
        deliveryAddress: '852 Industrial Estate, Patancheru, Hyderabad, Telangana, India',
        status: 'Closed',
      },
      {
        poNumber: 'PO10010',
        material: 'Electrical Cables',
        quantity: 400,
        unit: 'Meters',
        deliveryDate: '2024-07-27',
        netPrice: 12.0,
        totalAmount: 4800.0,
        deliveryAddress: '951 Industrial Area, Sector 82, Mohali, Punjab, India',
        status: 'Open',
      },
      {
        poNumber: 'PO10011',
        material: 'Concrete Bags',
        quantity: 1000,
        unit: 'Bags',
        deliveryDate: '2024-07-19',
        netPrice: 7.5,
        totalAmount: 7500.0,
        deliveryAddress: '357 Industrial Area, Patparganj, Delhi, India',
        status: 'Pending',
      },
      {
        poNumber: 'PO10012',
        material: 'Wooden Planks',
        quantity: 600,
        unit: 'Planks',
        deliveryDate: '2024-07-21',
        netPrice: 25.0,
        totalAmount: 15000.0,
        deliveryAddress: '258 Industrial Area, Balanagar, Hyderabad, Telangana, India',
        status: 'Closed',
      },
      {
        poNumber: 'PO10013',
        material: 'Insulation Foam',
        quantity: 350,
        unit: 'Liters',
        deliveryDate: '2024-07-23',
        netPrice: 18.0,
        totalAmount: 6300.0,
        deliveryAddress: '147 Industrial Area, Pimpri, Pune, Maharashtra, India',
        status: 'Open',
      },
      {
        poNumber: 'PO10014',
        material: 'Steel Sheets',
        quantity: 120,
        unit: 'Sheets',
        deliveryDate: '2024-07-26',
        netPrice: 110.0,
        totalAmount: 13200.0,
        deliveryAddress: '369 Industrial Area, Salt Lake, Kolkata, West Bengal, India',
        status: 'Pending',
      },
      {
        poNumber: 'PO10015',
        material: 'PVC Pipes',
        quantity: 500,
        unit: 'Meters',
        deliveryDate: '2024-07-29',
        netPrice: 8.0,
        totalAmount: 4000.0,
        deliveryAddress: '741 Industrial Area, Mancheswar, Bhubaneswar, Odisha, India',
        status: 'Closed',
      },
    ];

    // Current tab state
    let currentTab = 'Open';

    // Elements
    const poTableBody = document.getElementById('po-table-body');
    const tabs = document.querySelectorAll('.tab-btn');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalCloseBtn = document.getElementById('modal-close');
    const modalForm = document.getElementById('modal-form');
    const modalPoNumber = document.getElementById('modal-po-number');
    const modalMaterial = document.getElementById('modal-material');
    const modalQuantity = document.getElementById('modal-quantity');
    const modalUnit = document.getElementById('modal-unit');
    const modalDeliveryDate = document.getElementById('modal-delivery-date');
    const modalNetPrice = document.getElementById('modal-net-price');
    const modalTotalAmount = document.getElementById('modal-total-amount');
    const modalDeliveryAddress = document.getElementById('modal-delivery-address');
    const modalComments = document.getElementById('modal-comments');
    const modalAcknowledgeBtn = document.getElementById('modal-acknowledge');
    const modalRejectBtn = document.getElementById('modal-reject');

    // Render PO list based on current tab
    function renderPoList() {
      poTableBody.innerHTML = '';
      let filteredData = [];
      if (currentTab === 'Total') {
        filteredData = poData;
      } else {
        filteredData = poData.filter((po) => po.status === currentTab);
      }

      if (filteredData.length === 0) {
        poTableBody.innerHTML = `
          <tr>
            <td colspan="10" class="text-center py-6 text-gray-500 italic">No purchase orders found for "${currentTab}" status.</td>
          </tr>
        `;
        return;
      }

      filteredData.forEach((po) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50 cursor-pointer';

        // Format date
        const deliveryDateFormatted = new Date(po.deliveryDate).toLocaleDateString(undefined, {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
        });

        // Format prices
        const netPriceFormatted = "₹" + po.netPrice.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
        const totalAmountFormatted = "₹" + po.totalAmount.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });

        // Status badge color
        let statusColor = 'bg-gray-400 text-white';
        if (po.status === 'Open') statusColor = 'bg-green-600 text-white';
        else if (po.status === 'Pending') statusColor = 'bg-yellow-500 text-white';
        else if (po.status === 'Closed') statusColor = 'bg-gray-600 text-white';

        tr.innerHTML = `
          <td class="px-4 py-3 font-medium text-blue-700">${po.poNumber}</td>
          <td class="px-4 py-3">${po.material}</td>
          <td class="px-4 py-3">${po.quantity.toLocaleString()}</td>
          <td class="px-4 py-3">${po.unit}</td>
          <td class="px-4 py-3">${deliveryDateFormatted}</td>
          <td class="px-4 py-3">${netPriceFormatted}</td>
          <td class="px-4 py-3">${totalAmountFormatted}</td>
          <td class="px-4 py-3 max-w-xs truncate" title="${po.deliveryAddress}">${po.deliveryAddress}</td>
          <td class="px-4 py-3 text-center">
            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold ${statusColor}">${po.status}</span>
          </td>
          <td class="px-4 py-3 text-center">
            ${
              po.status === 'Open' || po.status === 'Pending'
                ? `<div class="flex flex-col items-center space-y-2">
                    <button data-po="${po.poNumber}" class="ack-btn bg-green-100 text-green-700 hover:bg-green-200 px-3 py-1 rounded-md font-semibold w-28 flex items-center justify-center" title="Acknowledge PO"><i class="fas fa-check-circle mr-1"></i>Acknowledge</button>
                    <button data-po="${po.poNumber}" class="rej-btn bg-red-100 text-red-700 hover:bg-red-200 px-3 py-1 rounded-md font-semibold w-28 flex items-center justify-center" title="Reject PO"><i class="fas fa-times-circle mr-1"></i>Reject</button>
                  </div>`
                : `<i class="fas fa-lock text-gray-400" title="No actions available"></i>`
            }
          </td>
        `;

        poTableBody.appendChild(tr);
      });

      // Attach event listeners for acknowledge and reject buttons
      document.querySelectorAll('.ack-btn').forEach((btn) => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const poNumber = btn.getAttribute('data-po');
          openModal(poNumber);
        });
      });
      document.querySelectorAll('.rej-btn').forEach((btn) => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const poNumber = btn.getAttribute('data-po');
          openModal(poNumber);
        });
      });
    }

    // Open modal with PO details
    let currentPo = null;

    function openModal(poNumber) {
      currentPo = poData.find((po) => po.poNumber === poNumber);
      if (!currentPo) return;

      modalTitle.textContent = `PO Acknowledgment / Rejection - ${currentPo.poNumber}`;
      modalPoNumber.value = currentPo.poNumber;
      modalMaterial.value = currentPo.material;
      modalQuantity.value = currentPo.quantity;
      modalUnit.value = currentPo.unit;
      modalDeliveryDate.value = currentPo.deliveryDate;
      modalNetPrice.value = "₹" + currentPo.netPrice.toFixed(2);
      modalTotalAmount.value = "₹" + currentPo.totalAmount.toFixed(2);
      modalDeliveryAddress.value = currentPo.deliveryAddress;
      modalComments.value = '';

      modal.classList.remove('hidden');
      modalComments.focus();
    }

    // Close modal
    function closeModal() {
      modal.classList.add('hidden');
      currentPo = null;
      modalComments.value = '';
    }

    // Update PO status on acknowledge or reject
    function updatePoStatus(newStatus, comments) {
      if (!currentPo) return;
      // Only allow status change if current status is Open or Pending
      if (currentPo.status === 'Closed') return;

      currentPo.status = newStatus;
      // Optionally, you could store comments somewhere or send to backend
      // For now, just log it
      console.log(`PO ${currentPo.poNumber} marked as ${newStatus}. Comments: ${comments}`);

      closeModal();
      renderPoList();
    }

    // Tab switching
    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        tabs.forEach((t) => {
          t.classList.remove('text-blue-600', 'border-blue-600');
          t.classList.add('text-gray-600', 'border-transparent');
        });
        tab.classList.add('text-blue-600', 'border-blue-600');
        tab.classList.remove('text-gray-600', 'border-transparent');
        currentTab = tab.textContent.trim();
        renderPoList();
      });
    });

    // Modal button events
    modalCloseBtn.addEventListener('click', closeModal);
    modalAcknowledgeBtn.addEventListener('click', () => {
      updatePoStatus('Pending', modalComments.value.trim());
    });
    modalRejectBtn.addEventListener('click', () => {
      updatePoStatus('Closed', modalComments.value.trim());
    });

    // Close modal on outside click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    // Initial render
    renderPoList();
  </script>
</body>
</html>